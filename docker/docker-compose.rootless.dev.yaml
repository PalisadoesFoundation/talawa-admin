# Rootless compose requires UID/GID exported for USER_UID/USER_GID mapping.
# Local setup example:
#   export UID="$(id -u)"
#   export GID="$(id -g)"
# CI already exports these values.
services:
  app:
    build:
      context: ..
      dockerfile: docker/Dockerfile.rootless.dev
      args:
        USER_UID: '${UID:-1000}'
        USER_GID: '${GID:-1000}'
    ports:
      - '${PORT:-4321}:${PORT:-4321}'
    env_file:
      - ../.env
    user: '${UID:-1000}:${GID:-1000}'
    volumes:
      - ..:/usr/src/app
      - /usr/src/app/node_modules
    healthcheck:
      test: ['CMD', 'wget', '--spider', '-q', 'http://localhost:${PORT:-4321}']
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
