
pnpm run generate-docs
pnpm run format:fix
# pnpm run lint:fix
pnpm run lint-staged
pnpm run typecheck

STAGED_TS=$(git diff --cached --name-only -z --diff-filter=ACMRT | grep -zE '^src/.*\.(ts|tsx)$' | grep -zvE '\.(spec|test)\.tsx?$')
if [ -n "$STAGED_TS" ]; then
  echo "ðŸ“ Validating TSDoc comments on staged files..."
  echo "$STAGED_TS" | xargs -0 npx eslint --rule "tsdoc/syntax: error" --max-warnings=0
fi
STAGED_SRC=$(git diff --cached --name-only --diff-filter=ACMRT | grep -E '^src/.*\.(ts|tsx|js|jsx)$' | tr '\n' ' ')
if [ -n "$STAGED_SRC" ]; then
  pnpm run check-i18n -- $STAGED_SRC
fi
pnpm run update:toc
pnpm run check:pom
npx knip --include files,exports,nsExports,nsTypes
npx knip --config knip.deps.json --include dependencies
pnpm run check-mock-cleanup
pnpm run check-localstorage

# 3. CSS Policy Check
# Exclude src/utils/ (utility/helper functions) and src/types/ (type definitions) 
# as they cannot contain UI styling code
CSS_STAGED=$(git diff --cached --name-only --diff-filter=ACMRT | grep -v '^src/utils/' | grep -v '^src/types/' || true)
if [ -n "$CSS_STAGED" ]; then
  # Find python3 or fallback to python
  if command -v python3 >/dev/null 2>&1; then
    PYTHON_CMD=python3
  elif command -v python >/dev/null 2>&1; then
    PYTHON_CMD=python
  else
    echo "Error: Python is not installed." >&2
    exit 1
  fi
  echo "$CSS_STAGED" | xargs $PYTHON_CMD .github/workflows/scripts/css_check.py --files
fi

git add .
