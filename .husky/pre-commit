
pnpm run generate-docs
pnpm run format:fix
# pnpm run lint:fix
pnpm run lint-staged
pnpm run typecheck
STAGED_SRC=$(git diff --cached --name-only --diff-filter=ACMRT | grep -E '^src/.*\.(ts|tsx|js|jsx)$' | tr '\n' ' ')
if [ -n "$STAGED_SRC" ]; then
  pnpm run check-i18n -- $STAGED_SRC
fi
pnpm run update:toc
pnpm run check:pom
npx knip --include files,exports,nsExports,nsTypes
npx knip --config knip.deps.json --include dependencies
pnpm run check-mock-cleanup
pnpm run check-localstorage

# FIND Python binary based on environment
PYTHON_BIN=${PYTHON_BIN:-python}

# Check if Python is installed
if command -v "$PYTHON_BIN" >/dev/null 2>&1; then

  # Check if required Python packages are installed
  $PYTHON_BIN .github/workflows/scripts/check_python_deps.py

  echo "Running Python CI parity checks..."
  # Python CI Parity Checks
  $PYTHON_BIN .github/workflows/scripts/check_docstrings.py --directories .github
  $PYTHON_BIN .github/workflows/scripts/compare_translations.py --directory public/locales

  # Check staged source files for various checks
  if [ -n "$STAGED_SRC" ]; then
      echo "$STAGED_SRC" | xargs $PYTHON_BIN .github/workflows/scripts/countline.py --lines 600
      echo "$STAGED_SRC" | xargs $PYTHON_BIN .github/workflows/scripts/translation_check.py --files
      echo "$STAGED_SRC" | xargs $PYTHON_BIN .github/workflows/scripts/disable_statements_check.py --files
  fi

  # 3. CSS Policy Check
  # Exclude src/utils/ (utility/helper functions) and src/types/ (type definitions) 
  # as they cannot contain UI styling code
  CSS_STAGED=$(git diff --cached --name-only --diff-filter=ACMRT | grep -v '^src/utils/' | grep -v '^src/types/' || true)
  if [ -n "$CSS_STAGED" ]; then
    echo "$CSS_STAGED" | xargs $PYTHON_BIN .github/workflows/scripts/css_check.py --files
  fi

else
  echo "Python binary could not be found"
fi



git add .
