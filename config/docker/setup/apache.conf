<VirtualHost *:80>
    # CHANGE THIS: Update 'localhost' to your real domain name in production
    ServerName localhost
    
    # Standard Apache web root
    DocumentRoot /usr/local/apache2/htdocs

    # Proxy GraphQL requests to the internal API container
    # 'api' is the Docker Service Name defined in docker-compose.yml.
    # If running outside Docker, replace 'api' with your API IP address.
    ProxyPass /graphql http://api:4000/graphql
    ProxyPassReverse /graphql http://api:4000/graphql

    # Handle WebSocket upgrades
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule ^/graphql(.*)$           ws://api:4000/graphql$1 [P,L]

    # Serve React App
    <Directory /usr/local/apache2/htdocs>
        Options FollowSymLinks
        AllowOverride None
        Require all granted
        FallbackResource /index.html
    </Directory>
</VirtualHost>