"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[42331],{29438:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var i=s(30758);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},30814:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/pull-request-40d63bbe012bd671a7dd68285279f8f8.yml"},78855:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"docs/developer-resources/testing","title":"Testing","description":"Introduction","source":"@site/docs/docs/developer-resources/testing.md","sourceDirName":"docs/developer-resources","slug":"/developer-resources/testing","permalink":"/docs/developer-resources/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-admin/edit/develop/docs/docs/docs/developer-resources/testing.md","tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"id":"testing","title":"Testing","slug":"/developer-resources/testing","sidebar_position":60},"sidebar":"tutorialSidebar","previous":{"title":"Plugin GraphQL Integration","permalink":"/docs/developer-resources/plugin-graphql-integration"},"next":{"title":"End to End Testing","permalink":"/docs/developer-resources/e2e-testing"}}');var t=s(86070),r=s(29438);const l={id:"testing",title:"Testing",slug:"/developer-resources/testing",sidebar_position:60},o=void 0,c={},a=[{value:"Introduction",id:"introduction",level:2},{value:"Developers using Microsoft Windows",id:"developers-using-microsoft-windows",level:3},{value:"UI/UX Testing",id:"uiux-testing",level:3},{value:"Pre-commit Hooks",id:"pre-commit-hooks",level:2},{value:"Bypassing Hooks",id:"bypassing-hooks",level:3},{value:"Linting and Formatting",id:"linting-and-formatting",level:2},{value:"Vitest Testing",id:"vitest-testing",level:2},{value:"Running Tests",id:"running-tests",level:3},{value:"Test Coverage",id:"test-coverage",level:3},{value:"Test Sharding",id:"test-sharding",level:3},{value:"Test Isolation and Mock Cleanup",id:"test-isolation-and-mock-cleanup",level:3},{value:"The Mock Cleanup Rule",id:"the-mock-cleanup-rule",level:4},{value:"Multi-Layer Enforcement",id:"multi-layer-enforcement",level:4},{value:"ESLint (Real-time IDE Feedback)",id:"eslint-real-time-ide-feedback",level:5},{value:"CI Check (GitHub Actions)",id:"ci-check-github-actions",level:5},{value:"Best Practices",id:"best-practices",level:4},{value:"Common Patterns",id:"common-patterns",level:4},{value:"When to Use Each Cleanup Method",id:"when-to-use-each-cleanup-method",level:4},{value:"Advanced: Global State Cleanup",id:"advanced-global-state-cleanup",level:4},{value:"Troubleshooting",id:"troubleshooting",level:4},{value:"Code Coverage Standards",id:"code-coverage-standards",level:3},{value:"Cypress End-to-End Testing",id:"cypress-end-to-end-testing",level:2},{value:"Debugging Tests",id:"debugging-tests",level:2},{value:"Husky for Git Hooks",id:"husky-for-git-hooks",level:2},{value:"pre-commit hook",id:"pre-commit-hook",level:3},{value:"post-merge hook",id:"post-merge-hook",level:3}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(n.p,{children:"It is important to test our code. If you are a contributor, please follow the guidance on this page."}),"\n",(0,t.jsx)(n.h3,{id:"developers-using-microsoft-windows",children:"Developers using Microsoft Windows"}),"\n",(0,t.jsx)(n.p,{children:"All our workflows use Linux based commands, therefore if you are a developer who codes in Microsoft Windows then we strongly suggest that you use the Windows Subsystem for Linux (WSL) as your command line interface (CLI)."}),"\n",(0,t.jsx)(n.h3,{id:"uiux-testing",children:"UI/UX Testing"}),"\n",(0,t.jsxs)(n.p,{children:["If you have loaded the API sample database, then you can login using the credentials found on the ",(0,t.jsx)(n.a,{href:"https://docs-api.talawa.io/docs/developer-resources/testing/",children:"testing page of the API documentation website"})]}),"\n",(0,t.jsx)(n.h2,{id:"pre-commit-hooks",children:"Pre-commit Hooks"}),"\n",(0,t.jsx)(n.p,{children:"To ensure the quality of the code in our pull requests, we have implemented hooks that run a series of scripts with each commit. These include scripts that:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Generate dooumentation from TypeDoc for the ",(0,t.jsx)(n.a,{href:"https://docs-admin.talawa.io",children:"https://docs-admin.talawa.io"})," website for easy cross referenced documentation for all methods, functions and classes"]}),"\n",(0,t.jsxs)(n.li,{children:["Fix formatting using ",(0,t.jsx)(n.code,{children:"prettier"})]}),"\n",(0,t.jsx)(n.li,{children:"Lints the code"}),"\n",(0,t.jsx)(n.li,{children:"Validate types using typecheck"}),"\n",(0,t.jsx)(n.li,{children:"Update markdown table of contents"}),"\n",(0,t.jsx)(n.li,{children:"Check for unused exports"}),"\n",(0,t.jsx)(n.li,{children:"Check for unused dependencies"}),"\n",(0,t.jsx)(n.li,{children:"Validate that testing uses mock cleanup correctly"}),"\n",(0,t.jsx)(n.li,{children:"Check for Page Object Model (POM) compliance for E2E tests"}),"\n",(0,t.jsx)(n.li,{children:"Check for hard coded text in screens that should be translated."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The full list of checks can be found in this file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:".husky/pre-commit\n"})}),"\n",(0,t.jsx)(n.p,{children:"If violations are found, the commit is blocked with clear fix instructions."}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsx)(n.p,{children:"Our pull request checks also validate whether the pre-commit hooks have been applied and will fail if they were not. It is highly advised not to bypass the pre-commit hooks."}),(0,t.jsxs)(n.p,{children:["Make sure your last ",(0,t.jsx)(n.code,{children:"git commit"})," before a ",(0,t.jsx)(n.code,{children:"git push"})," does not bypass the hooks, and that all errors are corrected."]}),(0,t.jsxs)(n.p,{children:["Only ",(0,t.jsx)(n.code,{children:"git push"})," when the ",(0,t.jsx)(n.code,{children:"git commit"})," checks pass."]})]}),"\n",(0,t.jsx)(n.h3,{id:"bypassing-hooks",children:"Bypassing Hooks"}),"\n",(0,t.jsxs)(n.p,{children:["You can bypass the pre-commit checks using the ",(0,t.jsx)(n.code,{children:"--no-verify"})," flag with the ",(0,t.jsx)(n.code,{children:"git commit"})," command."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'git commit -m "message" --no-verify\n'})}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsx)(n.p,{children:"Our pull request checks also validate whether the pre-commit hooks have been applied and will fail if they were not. It is highly advised not to bypass the pre-commit hooks."}),(0,t.jsxs)(n.p,{children:["Make sure your last ",(0,t.jsx)(n.code,{children:"git commit"})," before a ",(0,t.jsx)(n.code,{children:"git push"})," does not bypass the hooks, and that all errors are corrected."]}),(0,t.jsxs)(n.p,{children:["Only ",(0,t.jsx)(n.code,{children:"git push"})," when the ",(0,t.jsx)(n.code,{children:"git commit"})," checks pass."]})]}),"\n",(0,t.jsx)(n.h2,{id:"linting-and-formatting",children:"Linting and Formatting"}),"\n",(0,t.jsx)(n.p,{children:"All pull requests must have code that is properly linted and formatted to ensure uniformity across the repository."}),"\n",(0,t.jsx)(n.p,{children:"Before opening a PR, run the following scripts to automatically lint and format the code:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run lint:fix\npnpm run format:fix\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Both scripts also have a ",(0,t.jsx)(n.code,{children:"check"})," counterpart, which is used by GitHub CI to ensure that the code is properly formatted.\nYou can run these scripts yourself to ensure that your pull request doesn't fail due to linting and formatting errors:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run lint:check\npnpm run format:check\n"})}),"\n",(0,t.jsx)(n.h2,{id:"vitest-testing",children:"Vitest Testing"}),"\n",(0,t.jsxs)(n.p,{children:["This project uses ",(0,t.jsx)(n.a,{href:"https://vitest.dev/",children:"Vitest"})," as the testing framework."]}),"\n",(0,t.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run all tests:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run a single test file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test /path/to/test/file\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Watch tests for changes:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:watch\n"})}),"\n",(0,t.jsx)(n.p,{children:"This opens the Vitest UI for interactive testing."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"test-coverage",children:"Test Coverage"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"View coverage for all test files:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:coverage\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"View coverage for a single test file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:coverage /path/to/test/file\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Generate HTML coverage report:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:coverage\ngenhtml coverage/lcov.info -o coverage\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"genhtml"})," command is part of the Linux ",(0,t.jsx)(n.code,{children:"lcov"})," package. Similar packages are available for Windows and MacOS."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"test-sharding",children:"Test Sharding"}),"\n",(0,t.jsx)(n.p,{children:"For improved performance, especially in CI/CD environments, you can run tests in parallel using sharding:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:shard\n"})}),"\n",(0,t.jsx)(n.p,{children:"To run a specific shard, use environment variables:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"SHARD_INDEX=1 SHARD_COUNT=4 pnpm run test:shard\n"})}),"\n",(0,t.jsx)(n.p,{children:"This divides the test suite into 4 parts and runs the 1st part. This is particularly useful for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Running tests in parallel across multiple CI jobs"}),"\n",(0,t.jsx)(n.li,{children:"Faster test execution on multi-core systems"}),"\n",(0,t.jsx)(n.li,{children:"Reducing overall test suite runtime"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You can also run sharded tests with coverage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:shard:coverage\n"})}),"\n",(0,t.jsx)(n.h3,{id:"test-isolation-and-mock-cleanup",children:"Test Isolation and Mock Cleanup"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"IMPORTANT:"})," Proper test isolation is critical for reliable tests. All test files that use mocks MUST clean them up in ",(0,t.jsx)(n.code,{children:"afterEach"})," to prevent mock leakage between tests."]}),"\n",(0,t.jsx)(n.h4,{id:"the-mock-cleanup-rule",children:"The Mock Cleanup Rule"}),"\n",(0,t.jsxs)(n.p,{children:["Every test file that uses ",(0,t.jsx)(n.code,{children:"vi.mock()"}),", ",(0,t.jsx)(n.code,{children:"vi.fn()"}),", or ",(0,t.jsx)(n.code,{children:"vi.spyOn()"})," ",(0,t.jsx)(n.strong,{children:"MUST"})," include:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"describe('YourComponent', () => {\n  afterEach(() => {\n    vi.restoreAllMocks();\n  });\n\n  // Your tests here\n});\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Why This Matters:"})," Without proper cleanup, mocks from one test can leak into others, causing:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Flaky tests that pass/fail randomly"}),"\n",(0,t.jsx)(n.li,{children:"Tests that fail when run in different orders"}),"\n",(0,t.jsx)(n.li,{children:"Hard-to-debug test failures in CI"}),"\n",(0,t.jsx)(n.li,{children:"False positives/negatives"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"multi-layer-enforcement",children:"Multi-Layer Enforcement"}),"\n",(0,t.jsxs)(n.p,{children:["We enforce mock isolation through ",(0,t.jsx)(n.strong,{children:"three layers"})," to catch issues as early as possible:"]}),"\n",(0,t.jsx)(n.h5,{id:"eslint-real-time-ide-feedback",children:"ESLint (Real-time IDE Feedback)"}),"\n",(0,t.jsxs)(n.p,{children:["A custom ESLint rule (",(0,t.jsx)(n.code,{children:"vitest-isolation/require-aftereach-cleanup"}),") detects missing mock cleanup ",(0,t.jsx)(n.strong,{children:"as you type"}),". Your IDE will show inline errors when:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Test files use ",(0,t.jsx)(n.code,{children:"vi.fn()"}),", ",(0,t.jsx)(n.code,{children:"vi.mock()"}),", or ",(0,t.jsx)(n.code,{children:"vi.spyOn()"})," without ",(0,t.jsx)(n.code,{children:"afterEach"})," cleanup"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"afterEach"})," exists but is missing cleanup methods"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The rule provides ",(0,t.jsx)(n.strong,{children:"autofix"})," capability - your IDE can automatically insert the proper ",(0,t.jsx)(n.code,{children:"afterEach"})," block."]}),"\n",(0,t.jsx)(n.h5,{id:"ci-check-github-actions",children:"CI Check (GitHub Actions)"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"Check-Mock-Isolation"})," job runs on every PR to ensure repository-wide compliance."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Run locally before pushing:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run check-mock-cleanup\n"})}),"\n",(0,t.jsx)(n.h4,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"DO:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Good: Cleanup after each test\ndescribe('MyComponent', () => {\n  afterEach(() => {\n    vi.restoreAllMocks();\n  });\n\n  it('test 1', () => {\n    const mockFn = vi.fn();\n    // test code\n  });\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Good: Use beforeEach for setup, afterEach for cleanup\ndescribe('MyComponent', () => {\n  beforeEach(() => {\n    vi.clearAllMocks(); // Clear call history\n  });\n\n  afterEach(() => {\n    vi.restoreAllMocks(); // Restore original implementations\n  });\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Good: Combine with other cleanup\nafterEach(() => {\n  cleanup(); // React Testing Library cleanup\n  vi.restoreAllMocks(); // Mock cleanup\n  clearAllItems(); // LocalStorage cleanup \n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"DON'T:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Bad: No cleanup - mocks leak between tests\ndescribe('MyComponent', () => {\n  it('test 1', () => {\n    const mockFn = vi.fn();\n    // Without cleanup, mockFn persists to next test!\n  });\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Bad: Only using clearAllMocks() - doesn't restore implementations\nafterEach(() => {\n  vi.clearAllMocks(); // Not enough!\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Bad: Module-level mocks without cleanup\nvi.mock('some-module'); // At top of file\n\ndescribe('MyComponent', () => {\n  // Missing afterEach cleanup!\n});\n"})}),"\n",(0,t.jsx)(n.h4,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Pattern 1: Component with Module Mocks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Top of file\nvi.mock('react-router', () => ({\n  useNavigate: vi.fn(),\n  useParams: vi.fn(),\n}));\n\ndescribe('MyComponent', () => {\n  afterEach(() => {\n    vi.restoreAllMocks(); // Required!\n  });\n\n  it('navigates correctly', () => {\n    const mockNavigate = vi.fn();\n    vi.mocked(useNavigate).mockReturnValue(mockNavigate);\n    // test code\n  });\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Pattern 2: Spy on Functions"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"describe('MyComponent', () => {\n  afterEach(() => {\n    vi.restoreAllMocks(); // Always restore spies!\n  });\n\n  it('calls console.log', () => {\n    const spy = vi.spyOn(console, 'log');\n    // test code\n    expect(spy).toHaveBeenCalled();\n  });\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Pattern 3: Function Mocks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"describe('MyComponent', () => {\n  const mockCallback = vi.fn();\n\n  afterEach(() => {\n    vi.restoreAllMocks(); // Restores mockCallback\n  });\n\n  it('calls callback', () => {\n    render(<MyComponent onSubmit={mockCallback} />);\n    // test code\n  });\n});\n"})}),"\n",(0,t.jsx)(n.h4,{id:"when-to-use-each-cleanup-method",children:"When to Use Each Cleanup Method"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Use Case"}),(0,t.jsx)(n.th,{children:"What It Does"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.restoreAllMocks()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Default - use in afterEach"})}),(0,t.jsx)(n.td,{children:"Restores all mocks to original implementations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.clearAllMocks()"})}),(0,t.jsx)(n.td,{children:"In beforeEach if needed"}),(0,t.jsx)(n.td,{children:"Clears call history but keeps mocks active"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.resetAllMocks()"})}),(0,t.jsx)(n.td,{children:"Rarely needed"}),(0,t.jsx)(n.td,{children:"Clears history AND resets return values"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vi.resetModules()"})}),(0,t.jsxs)(n.td,{children:["For ",(0,t.jsx)(n.code,{children:"vi.mock()"})," of modules"]}),(0,t.jsx)(n.td,{children:"Clears module cache (less common)"})]})]})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Rule of Thumb:"})," Use ",(0,t.jsx)(n.code,{children:"vi.restoreAllMocks()"})," in ",(0,t.jsx)(n.code,{children:"afterEach"})," for 99% of cases."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"advanced-global-state-cleanup",children:"Advanced: Global State Cleanup"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Timer Cleanup:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"describe('Component with timers', () => {\n  afterEach(() => {\n    vi.clearAllTimers();\n    vi.useRealTimers();\n  });\n\n  it('uses fake timers', () => {\n    vi.useFakeTimers();\n    // test code\n  });\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Window/Document Cleanup:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"describe('Component modifying globals', () => {\n  const originalLocation = window.location;\n\n  afterEach(() => {\n    window.location = originalLocation;\n    // Remove any added event listeners\n    document.removeEventListener('click', handler);\n  });\n\n  it('modifies window', () => {\n    window.location.href = 'test';\n  });\n});\n"})}),"\n",(0,t.jsx)(n.h4,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:'ESLint Error: "Test file uses mocks but is missing afterEach cleanup"'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Your IDE detected missing cleanup in real-time"}),"\n",(0,t.jsxs)(n.li,{children:["Apply ESLint autofix or manually add ",(0,t.jsx)(n.code,{children:"afterEach(() => { vi.restoreAllMocks(); })"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:'Pre-commit Hook Failed: "Check Mock Cleanup"'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The script found test files with missing cleanup"}),"\n",(0,t.jsx)(n.li,{children:"Review the error output for specific files and fix suggestions"}),"\n",(0,t.jsxs)(n.li,{children:["Bypass if absolutely needed: ",(0,t.jsx)(n.code,{children:"git commit --no-verify"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:'CI Error: "Check Mock Isolation failed"'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Same validation as pre-commit but caught in CI"}),"\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.code,{children:"afterEach(() => { vi.restoreAllMocks(); })"})," to flagged files"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Tests pass locally but fail in CI:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Likely mock leakage - ensure all test files have ",(0,t.jsx)(n.code,{children:"afterEach"})," cleanup"]}),"\n",(0,t.jsxs)(n.li,{children:["Run tests in shuffle mode: ",(0,t.jsx)(n.code,{children:"pnpm run test -- --sequence.shuffle"})]}),"\n",(0,t.jsx)(n.li,{children:"Check for window/document/timer manipulation without cleanup"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Tests fail in different order or when run together:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Classic sign of mock leakage"}),"\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.code,{children:"afterEach(() => { vi.restoreAllMocks(); })"})," to affected files"]}),"\n",(0,t.jsxs)(n.li,{children:["If using fake timers, add ",(0,t.jsx)(n.code,{children:"vi.clearAllTimers()"})," and ",(0,t.jsx)(n.code,{children:"vi.useRealTimers()"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Warning about window/document/timer usage:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"These are non-blocking warnings to improve test isolation"}),"\n",(0,t.jsx)(n.li,{children:"While they don't fail builds, addressing them prevents flaky tests"}),"\n",(0,t.jsx)(n.li,{children:"Follow the fix suggestions in the warning output"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"code-coverage-standards",children:"Code Coverage Standards"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The current code coverage of the repository: ",(0,t.jsx)(n.a,{href:"https://codecov.io/gh/PalisadoesFoundation/talawa-admin",children:(0,t.jsx)(n.img,{src:"https://codecov.io/gh/PalisadoesFoundation/talawa-admin/branch/develop/graph/badge.svg?token=II0R0RREES",alt:"codecov"})})]}),"\n",(0,t.jsxs)(n.li,{children:["The currently acceptable coverage rate can be found in the ",(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(30814).A+"",children:"GitHub Pull Request workflow file"}),". Search for the value below the line containing ",(0,t.jsx)(n.code,{children:"min_coverage"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"cypress-end-to-end-testing",children:"Cypress End-to-End Testing"}),"\n",(0,t.jsxs)(n.p,{children:["Cypress is used for end-to-end testing to ensure the application works correctly from a user's perspective.\nTo read more about Cypress testing, please refer to the ",(0,t.jsx)(n.a,{href:"/docs/developer-resources/e2e-testing",children:"Our end to end testing with Cypress guide"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"debugging-tests",children:"Debugging Tests"}),"\n",(0,t.jsxs)(n.p,{children:["You can see the output of failing tests in your browser using the ",(0,t.jsx)(n.code,{children:"vitest"})," UI:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm run test:watch\n"})}),"\n",(0,t.jsx)(n.p,{children:"This opens an interactive UI where you can:\\n- View test results in real-time"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Debug failing tests"}),"\n",(0,t.jsx)(n.li,{children:"Re-run specific tests"}),"\n",(0,t.jsx)(n.li,{children:"View detailed error messages and stack traces"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"husky-for-git-hooks",children:"Husky for Git Hooks"}),"\n",(0,t.jsxs)(n.p,{children:["We are using the package ",(0,t.jsx)(n.code,{children:"Husky"})," to run git hooks that run according to different git workflows."]}),"\n",(0,t.jsx)(n.h3,{id:"pre-commit-hook",children:"pre-commit hook"}),"\n",(0,t.jsx)(n.p,{children:"We run a pre-commit hook which automatically runs code quality checks each time you make a commit and also fixes some of the issues. This includes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Documentation generation"}),"\n",(0,t.jsx)(n.li,{children:"Code formatting and linting"}),"\n",(0,t.jsx)(n.li,{children:"Type checking"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mock isolation validation"})," (",(0,t.jsx)(n.code,{children:"check-mock-cleanup.sh"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Unused file/dependency detection"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The mock isolation check ensures all test files with mocks have proper cleanup before you commit. This catches issues early, before they reach CI."}),"\n",(0,t.jsxs)(n.p,{children:["If you don't want these pre-commit checks running on each commit, you can manually opt out of it using the ",(0,t.jsx)(n.code,{children:"--no-verify"})," flag with your commit message as shown:-"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'git commit -m "commit message" --no-verify\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," Only bypass the pre-commit hook if absolutely necessary. It's designed to catch common issues and save CI time."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"post-merge-hook",children:"post-merge hook"}),"\n",(0,t.jsx)(n.p,{children:'We are also running a post-merge(post-pull) hook which will automatically run "pnpm install" only if there is any change made to package.json file so that the developer has all the required dependencies when pulling files from remote.'}),"\n",(0,t.jsxs)(n.p,{children:["If you don't want this hook to run, you can manually opt out of this using the ",(0,t.jsx)(n.code,{children:"--no-verify"})," flag while using the merge command ",(0,t.jsx)(n.code,{children:"git pull"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git pull --no-verify\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);